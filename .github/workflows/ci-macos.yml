---
name: CI-MacOS
on: [push, pull_request]

jobs:
  build:
    name: Build and Test
    runs-on: macos-latest

    steps:
      - name: Install prerequisites
        run: >-
          brew install
          libgcrypt
          ninja
          doxygen
          graphviz

      - uses: actions/checkout@v3

      - name: Configure
        run: cmake --preset default --fresh

      - name: Build
        run: cmake --build  --preset srecord-executables

      - name: Smoke test
        run: cmake --build  --preset srecord-executables-version

      - name: Build test prerequisites
        run: cmake --build  --preset prepare-test

      - name: Test
        working-directory: build
        run: ctest --output-on-failure --output-junit ctest.junit.xml
